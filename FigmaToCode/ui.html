<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>

<body>
  <div id="div-container"></div>
</body>

</html>
<script>

  onmessage = ({ data }) => {
    const { pluginMessage: { components } } = data;
    let htmlCode = createDiv(components);
    htmlCode = "<!DOCTYPE html>\n<html>\n<body>" + htmlCode + "</body>\n</html>";
    document.getElementById('div-container').innerText = htmlCode;
    createDiv(components);
  };


</script>

<script>
  function createDiv(components) {
    if (components &&
      components.length) {
      let htmlCode = "";
      components.forEach(element => {
        htmlCode = htmlCode + getHtmlCodeDiv(element);
      });
      return htmlCode;
    } return '';
  }
</script>

<script>
  function getHtmlCodeDiv(element) {
    if (element) {
      console.log("element", element);
      const divHtml = `
    <div 
        style='
        background-color: ${getBackgroundColor(element)};
        width:${element.width}; 
        height:${element.height};
        position:${element.position};
        top:${element.pos_y};
        left:${element.pos_x}
        '>
              ${createDiv(element.children)}
    </div>
    `;
      return divHtml;
    }
    return null;
  }

</script>

<script>
  function getBackgroundColor(element) {
    if (element.color) {
      return `rgb(${element.color.r},${element.color.g},${element.color.b})`;
    } return 'none';
  }
</script>